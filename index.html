<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="board">
      <table>
        <tr class="upper">
          <td class="endcap" rowspan="2">B</td>
          <td id="0"></td>
          <td id="1"></td>
          <td id="2"></td>
          <td id="3"></td>
          <td id="4"></td>
          <td id="5"></td>
          <td class="endcap" rowspan="2">A</td>
        </tr>
        <tr class="lower">
          <td id="11"></td>
          <td id="10"></td>
          <td id="9"></td>
          <td id="8"></td>
          <td id="7"></td>
          <td id="6"></td>
        </tr>
      </table>
      <h3>Turn: Player A</h3>
    </div>
    <script>
      //INITIALIZE
      const turnText = document.querySelector("h3");

      let player1Turn = true;
      //grabbing all cells
      const pitsA = document.querySelectorAll(".upper td:not(.endcap)"); //everything on the top and the two end zones.
      const pitsB = document.querySelectorAll(".lower td"); //everything on the bottom and no end zones.

      //seperating goal A and goal B into seperate elements for ease of use
      const goals = document.querySelectorAll("td.endcap");
      goals.forEach((x) => x.setAttribute("value", "0"));
      console.log(goals[0].getAttribute("class"));

      // Player A moves will use the first, while when player B moves it uses the second.
      // This is to avoid needing to do extra logic when moving around the board and allows for more code reuse.
      var myPitsA = [];
      var myPitsB = [];

      for (let pit of pitsA) {
        myPitsA.push(pit);
        myPitsB.push(pit);
      }

      // Add B goal to middle of B list.
      myPitsB.push(goals[1]);

      for (let i = pitsB.length - 1; i >= 0; i--) {
        myPitsA.push(pitsB[i]);
        myPitsB.push(pitsB[i]);
      }

      //add A goal to end of A list.
      myPitsA.push(goals[0]);
      console.log(myPitsA);

      pitsA.forEach((x) => {
        x.setAttribute("value", "4");
        x.addEventListener("click", () => {
          move_next(event, myPitsB);
        });
      });
      pitsB.forEach((x) => {
        x.setAttribute("value", "4");
        x.addEventListener("click", () => move_next(event, myPitsA));
      });

      //END INITIALIZE

      function move_next(event, playerPits) {
        if (Number(event.target.id) < 6 && !player1Turn) {
          alert("Invalid Move!");
          return 0;
        } else if (Number(event.target.id) >= 6 && player1Turn) {
          alert("Invalid Move!");
          return 0;
        }

        let stones = Number(event.target.getAttribute("value"));
        if (stones == 0) {
          alert("Must select a pit with pebbles inside.");
          return 0;
        }
        let bonusBool = false;
        if (event.target.getAttribute("value") == "0") {
          bonusBool = true;
        }
        event.target.setAttribute("value", 0);
        let numPOS = num_check(playerPits.indexOf(event.target) + 1);
        while (stones > 0) {
          var newStones = Number(playerPits[numPOS].getAttribute("value")) + 1;
          playerPits[numPOS].setAttribute("value", newStones);
          //see if last stone lands in goal
          console.log(playerPits[numPOS].getAttribute("class"));
          if (stones == 1) {
            const goal = playerPits.querySelector(".endcap");
            var goalIndex = Number(playerPits.indexOf(goal));
            if (Math.abs(goalIndex - numPOS) > 6) {
              bonusBool = false;
            }
            if (bonusBool) {
              var newTotal =
                steal(numPOS) +
                Number(
                  playerPits.querySelector(".endcap").getAttribute("value")
                );
              playerPits
                .querySelector(".endgoal")
                .setAttribute("value", newTotal);
              //steal pebbles from opposite side
            } else if (playerPits[numPOS].getAttribute("class") == "endcap") {
              //player qualifies for bonus turn!
              return;
            }
          }
          stones = stones - 1;
          numPOS = num_check(numPOS + 1);
        }
        player1Turn = !player1Turn;
        if (player1Turn) {
          turnText.innerText = "Turn: Player A";
        } else {
          turnText.innerText = "Turn: Player B";
        }
      }

      function num_check(num) {
        if (num > 12) {
          return (num % 12) - 1;
        }
        return num;
      }

      function steal(pitID) {
        switch (Number(pitID)) {
          case 0:
            pitID = 11;
            break;
          case 1:
            pitID = 10;
            break;
          case 2:
            pitID = 9;
            break;
          case 3:
            pitID = 8;
            break;
          case 4:
            pitID = 7;
            break;
          case 5:
            pitID = 6;
            break;
          case 6:
            pitID = 5;
            break;
          case 7:
            pitID = 4;
            break;
          case 8:
            pitID = 3;
            break;
          case 9:
            pitID = 2;
            break;
          case 10:
            pitID = 1;
            break;
          case 11:
            pitID = 0;
            break;
        }
        const stealFrom = document.getElementById(pitID);
        let stolenStones = Number(stealFrom.getAttribute("value"));
        stealFrom.setAttribute("value", "0");
        return stolenStones;
      }
    </script>
  </body>
</html>
